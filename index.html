<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reabilita√ß√£o Inteligente | Dr. Jo√£o Paulo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">

    <script
      async
      crossorigin="anonymous"
      data-clerk-publishable-key="pk_test_c3BsZW5kaWQtY2xhbS0xOS5jbGVyay5hY2NvdW50cy5kZXYk"
      src="https://allowed-mule-51.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
      type="text/javascript">
    </script>

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; 
            padding-bottom: 150px;
            
            /* --- BLINDAGEM DE TEXTO (NOVO) --- */
            /* Impede que o usu√°rio selecione o texto com o mouse */
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none;    /* Firefox */
            -ms-user-select: none;     /* IE/Edge */
            user-select: none;         /* Chrome/Padr√£o */
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Estilo do C√≠rculo de Progresso */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.5s ease-in-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        /* V√≠deos */
        video { border-radius: 0.75rem; background-color: #000; }
        
        /* Esconde o app at√© o login carregar */
        #app-wrapper { display: none; }
    </style>
</head>
<body>

    <div id="app-wrapper">

        <header class="bg-white/90 backdrop-blur-xl border-b border-slate-200 sticky top-0 z-40">
            <div class="max-w-2xl mx-auto px-6 h-16 flex items-center justify-between">
                <div class="flex items-center gap-3 cursor-pointer" onclick="renderPhase(0)">
                    <div class="w-10 h-10 rounded-xl bg-blue-600 flex items-center justify-center shadow-lg relative border border-slate-100 transition-transform hover:scale-105 overflow-hidden">
                        <img src="foto-jp.jpg" alt="JP" class="w-full h-full object-cover" onerror="this.style.display='none'; this.parentElement.innerHTML='<span class=\'text-white font-black italic text-sm\'>JP</span>';">
                    </div>
                    <div>
                        <span class="block text-[9px] font-black tracking-widest text-slate-400 uppercase">Fisioterapia</span>
                        <span class="block text-xs font-black tracking-tighter text-slate-800 leading-none">REABILITA√á√ÉO INTELIGENTE</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-3">
                    <div id="user-button"></div>

                    <div class="relative w-10 h-10">
                        <svg class="w-full h-full" viewBox="0 0 100 100">
                            <circle class="text-slate-200 stroke-current" stroke-width="10" cx="50" cy="50" r="40" fill="transparent"></circle>
                            <circle id="progress-ring" class="text-blue-600 progress-ring__circle stroke-current" stroke-width="10" stroke-linecap="round" cx="50" cy="50" r="40" fill="transparent" stroke-dasharray="251.2" stroke-dashoffset="251.2"></circle>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="global-progress-text" class="text-[9px] font-black text-blue-600">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-2xl mx-auto px-6 py-6">
            <nav class="flex gap-2 p-1 bg-slate-200 rounded-2xl mb-8 overflow-x-auto no-scrollbar sticky top-20 z-30 shadow-inner">
                <button onclick="renderPhase(0)" id="btn-0" class="flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all bg-blue-600 text-white shadow-md">IN√çCIO</button>
                <button onclick="renderPhase(1)" id="btn-1" class="flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all text-slate-500 hover:bg-white/50">FASE 1</button>
                <button onclick="renderPhase(2)" id="btn-2" class="flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all text-slate-500 hover:bg-white/50">FASE 2</button>
                <button onclick="renderPhase(3)" id="btn-3" class="flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all text-slate-500 hover:bg-white/50">FASE 3</button>
            </nav>

            <div id="app-content" class="fade-in"></div>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur border-t border-slate-200 p-4 z-50 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] safe-area-bottom">
            <div class="max-w-2xl mx-auto flex items-center justify-between gap-4">
                <div class="flex items-center gap-3 shrink-0 cursor-pointer hover:scale-105 transition-transform" onclick="toggleChat()">
                    <div class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center relative shadow-sm">
                        <i data-lucide="message-circle" class="w-5 h-5"></i>
                        <span class="absolute top-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full animate-pulse"></span>
                    </div>
                    <div class="hidden sm:block">
                        <p class="text-[10px] font-black text-slate-400 leading-none mb-0.5">D√öVIDAS?</p>
                        <p class="text-xs font-bold text-slate-700">Assistente Virtual</p>
                    </div>
                </div>
                
                <a href="https://wa.me/5521972183072" target="_blank" class="flex-1 bg-slate-900 text-white px-4 py-3 rounded-xl shadow-lg active:scale-95 transition-all flex items-center justify-between hover:bg-slate-800 group">
                    <div class="flex flex-col">
                        <span class="text-[8px] uppercase tracking-widest text-slate-400 group-hover:text-blue-300 transition-colors">Acelere sua recupera√ß√£o</span>
                        <span class="text-[11px] font-black flex items-center gap-2">CONSULTORIA PREMIUM</span>
                    </div>
                    <div class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-colors">
                        <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-yellow-400"></i>
                    </div>
                </a>
            </div>
        </nav>

        <div id="chat-modal" class="fixed inset-0 z-[60] flex items-end sm:items-center justify-center pointer-events-none p-4 bg-black/20 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
            <div class="bg-white w-full max-w-md h-[500px] max-h-[80vh] rounded-2xl shadow-2xl border border-slate-200 flex flex-col pointer-events-auto transform transition-transform duration-300 translate-y-10 scale-95">
                <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-blue-600 rounded-t-2xl text-white">
                    <div class="flex items-center gap-2">
                        <i data-lucide="bot" class="w-4 h-4"></i>
                        <h3 class="font-bold text-sm">Suporte Autom√°tico</h3>
                    </div>
                    <button onclick="toggleChat()"><i data-lucide="x" class="w-4 h-4"></i></button>
                </div>
                <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50">
                    <div class="flex justify-start">
                        <div class="max-w-[85%] p-3 rounded-2xl text-xs leading-relaxed bg-white text-slate-700 shadow-sm border border-slate-200 rounded-bl-none">
                            Ol√°! Sou o assistente virtual. Digite palavras como "dor", "gelo", "incha√ßo" ou "exerc√≠cio" que eu tento te ajudar!
                        </div>
                    </div>
                </div>
                <form onsubmit="sendMessage(event)" class="p-3 bg-white border-t border-slate-100 rounded-b-2xl flex gap-2">
                    <input id="chat-input" type="text" placeholder="Digite sua d√∫vida..." class="flex-1 bg-slate-100 rounded-xl px-4 text-sm outline-none focus:ring-2 focus:ring-blue-500">
                    <button type="submit" class="bg-blue-600 text-white p-3 rounded-xl"><i data-lucide="send" class="w-4 h-4"></i></button>
                </form>
            </div>
        </div>

    </div> <script>
        // --- DADOS DO PORTAL ---
        const PORTAL_DATA = {
            0: {
                title: "üëã Bem-vindo √† sua Recupera√ß√£o",
                intro: "Voc√™ n√£o est√° sozinho. Este portal cont√©m o m√©todo exato para te levar da cirurgia at√© voltar a andar com seguran√ßa.",
                instructions: "Toque na fase correspondente abaixo para liberar seus exerc√≠cios di√°rios.",
                videoSource: "boas_vindas.mp4",
                phases_summary: [
                    { id: 1, icon: "üõ°Ô∏è", title: "Fase 1: Prote√ß√£o", sub: "Semana 0-4 ‚Ä¢ Controle e Repouso" },
                    { id: 2, icon: "üë£", title: "Fase 2: Mobilidade", sub: "Liberado p√© no ch√£o (Carga Parcial)" },
                    { id: 3, icon: "üí™", title: "Fase 3: For√ßa Total", sub: "Liberado peso total (Largar Muletas)" }
                ],
                disclaimer: {
                    title: "Termos de Uso e Responsabilidade",
                    text: "Este aplicativo serve como guia de suporte e orienta√ß√£o domiciliar. Ele N√ÉO substitui o julgamento cl√≠nico do seu m√©dico ou fisioterapeuta presencial.",
                    crefito: "Fisioterapeuta: Dr. Jo√£o Paulo Cardozo"
                }
            },
            1: {
                title: "FASE 1: üõ°Ô∏è Prote√ß√£o",
                subtitle: "Semanas 0 a 4",
                intro: "Foco absoluto em desinchar e proteger a cirurgia. O objetivo √© manter o sangue circulando sem for√ßar o tornozelo.",
                introVideoSource: "fase1_intro.mp4",
                warning: {
                    title: "üö® Sinais de Alerta (Triagem)",
                    intro: "Fique atento a estes sinais que N√ÉO s√£o normais:",
                    items: [
                        { label: "Risco de Trombose", text: "Dor aguda isolada na panturrilha, incha√ßo repentino e rigidez." },
                        { label: "Sinais de Infec√ß√£o", text: "Secre√ß√£o (pus), vermelhid√£o ou febre." },
                        { label: "Circula√ß√£o", text: "Dedos muito p√°lidos ou frios." }
                    ],
                    footer: "Procure seu m√©dico se notar algo."
                },
                regraOuro: "Regra de Ouro: O desconforto leve √© normal, mas 'pontadas' agudas na cirurgia n√£o.",
                achievements: [ "Ferida seca e limpa", "Dormir sem dor intensa", "Incha√ßo diminui pela manh√£", "Mover dedos livremente" ],
                sections: [
                    { 
                        name: "Protocolo Di√°rio", 
                        desc: "üßä <strong>Gelo:</strong> 20min a cada 4h.\nü¶µ <strong>Eleva√ß√£o:</strong> Perna acima do cora√ß√£o.\nü¶∂ <strong>Movimento:</strong> Mexer dedos sempre.", 
                        why: "O b√°sico que funciona. Reduz a inflama√ß√£o e previne trombose.",
                        dosage: "Todo dia", 
                        videoSource: "" 
                    },
                    { 
                        name: "1. Bombeamento Isom√©trico", 
                        desc: "Fa√ßa for√ßa na batata da perna como se quisesse pisar no acelerador, mas SEM deixar o p√© mexer. Sinta o m√∫sculo endurecer, segure 3s e relaxe.", 
                        why: "Sua 'bomba' natural. Empurra o sangue de volta para o cora√ß√£o, diminuindo incha√ßo.",
                        dosage: "3x 10 reps", 
                        videoSource: "fase1_ex1.mp4" 
                    },
                    { 
                        name: "2. O 'Pianista'", 
                        desc: "Com a perna esticada, tente abrir bem os dedos dos p√©s e depois fechar com for√ßa (como se fosse agarrar um objeto).", 
                        why: "Evita que os tend√µes colem na cicatriz e ajuda a reduzir o edema.",
                        dosage: "3x 15 reps", 
                        videoSource: "fase1_ex2.mp4" 
                    },
                    { 
                        name: "3. Ativa√ß√£o de Gl√∫teo", 
                        desc: "Deitado, aperte uma n√°dega contra a outra com for√ßa. Segure 5s e relaxe.", 
                        why: "Mesmo deitado, seu gl√∫teo precisa trabalhar para n√£o atrofiar e manter estabilidade.",
                        dosage: "3x 15 reps", 
                        videoSource: "fase1_ex3.mp4" 
                    },
                    { 
                        name: "4. Eleva√ß√£o de Perna", 
                        desc: "Deitado, trave o joelho (deixe duro) e levante a perna esticada at√© a altura do outro joelho.", 
                        why: "Fortalece a coxa (quadr√≠ceps) sem colocar carga nenhuma no tornozelo.",
                        dosage: "3x 10 reps", 
                        videoSource: "fase1_ex4.mp4" 
                    },
                    { 
                        name: "5. P√© no Ch√£o (Adapta√ß√£o)", 
                        desc: "Sentado, apoie o p√© no ch√£o sem peso. Se ficar vermelho/latejar √© normal. Comece com 2 min e aumente.", 
                        why: "Prepara o sistema vascular para a gravidade antes de come√ßar a andar.",
                        dosage: "2 -> 15 min", 
                        videoSource: "fase1_ex5.mp4" 
                    }
                ]
            },
            2: {
                title: "FASE 2: üë£ Mobilidade",
                subtitle: "Carga Parcial Liberada",
                intro: "Vamos recuperar o movimento de 90¬∫ do tornozelo e ensinar seu p√© a receber peso novamente.",
                introVideoSource: "fase2_intro.mp4",
                warning: { type: "info", title: "‚ö†Ô∏è Requisito de Seguran√ßa", text: "S√≥ fa√ßa se o m√©dico liberou Carga Parcial (pisar com aux√≠lio)." },
                achievements: [ "P√© atinge 90 graus", "Piso com carga parcial sem dor", "Uso t√™nis confort√°vel", "Iniciei desmame muletas" ],
                sections: [
                    { 
                        name: "1. Alongamento Toalha", 
                        desc: "Sentado, passe uma toalha na ponta do p√©. Puxe a toalha trazendo os dedos na sua dire√ß√£o at√© sentir 'repuxar' a batata da perna.", 
                        why: "Recupera a flexibilidade da panturrilha para permitir o passo correto.",
                        dosage: "3x 30s", 
                        videoSource: "fase2_ex1.mp4" 
                    },
                    { 
                        name: "2. O Acelerador (Livre)", 
                        desc: "Leve o p√© o m√°ximo para cima (dedos pro nariz) e o m√°ximo para baixo. Tente ganhar 1mm a cada repeti√ß√£o.", 
                        why: "Solta a rigidez articular sem estressar os ligamentos laterais.",
                        dosage: "3x 15 reps", 
                        videoSource: "fase2_ex2.mp4" 
                    },
                    { 
                        name: "3. O Acelerador (El√°stico)", 
                        desc: "Passe um el√°stico na ponta do p√©. Empurre para baixo contra o el√°stico e segure a volta lentamente.", 
                        why: "Fortalecimento exc√™ntrico: essencial para recuperar a for√ßa de absor√ß√£o de impacto.",
                        dosage: "3x 15 reps", 
                        videoSource: "fase2_ex3.mp4" 
                    },
                    { 
                        name: "4. A Balan√ßa (Descarga)", 
                        desc: "Em p√© com muletas, transfira levemente o peso para o p√© operado (pisando em ovos). Se doer, alivie.", 
                        why: "Reeduca o c√©rebro a aceitar carga no membro operado (propriocep√ß√£o).",
                        dosage: "3x 1 min", 
                        videoSource: "fase2_ex4.mp4" 
                    }
                ]
            },
            3: {
                title: "FASE 3: üí™ For√ßa Total",
                subtitle: "Retorno √† Vida Normal",
                intro: "Foco em fortalecer a panturrilha e treinar o equil√≠brio. Prepara√ß√£o para alta.",
                introVideoSource: "fase3_intro.mp4",
                warning: { type: "stop", title: "‚õî Requisito Obrigat√≥rio", text: "Exige libera√ß√£o m√©dica para CARGA TOTAL (pisar sem muletas)." },
                achievements: [ "Degraus sem apoio", "Fico na ponta dos p√©s", "Equil√≠brio num p√© s√≥", "Caminho sem mancar" ],
                sections: [
                    { 
                        name: "1. Joelho na Parede", 
                        desc: "P√© a 10cm da parede. Tente encostar o joelho na parede SEM tirar o calcanhar do ch√£o.", 
                        why: "Aumenta a dorsiflex√£o, fundamental para descer escadas e agachar.",
                        dosage: "3x 12 reps", 
                        videoSource: "fase3_ex1.mp4" 
                    },
                    { 
                        name: "2. Eleva√ß√£o Calcanhar", 
                        desc: "Suba na ponta dos p√©s (Bipodal). Evolua para um p√© s√≥ (Unipodal) quando estiver forte.", 
                        why: "Fortalece a panturrilha, o 'motor' da caminhada. Evita que voc√™ manque.",
                        dosage: "3x 15 reps", 
                        videoSource: "fase3_ex2.mp4" 
                    },
                    { 
                        name: "3. Mini-Agachamento", 
                        desc: "Apoie na cadeira e dobre levemente os joelhos. N√£o tire calcanhares do ch√£o.", 
                        why: "Fortalecimento funcional de quadr√≠ceps para sentar e levantar.",
                        dosage: "3x 10 reps", 
                        videoSource: "fase3_ex3.mp4" 
                    },
                    { 
                        name: "4. O Gar√ßa (Equil√≠brio)", 
                        desc: "Equilibre-se na perna operada. Tente soltar a m√£o da parede aos poucos.", 
                        why: "Treino de equil√≠brio para prevenir novas tor√ß√µes no futuro.",
                        dosage: "3x 30s", 
                        videoSource: "fase3_ex4.mp4" 
                    },
                    { 
                        name: "5. Passo sobre Obst√°culo", 
                        desc: "Passe a perna boa por cima de um objeto enquanto equilibra na operada.", 
                        why: "Desafio avan√ßado de estabilidade din√¢mica.",
                        dosage: "3x 10v", 
                        videoSource: "fase3_ex5.mp4" 
                    }
                ]
            }
        };

        // --- SISTEMA CLERK E INICIALIZA√á√ÉO ---
        window.addEventListener('load', async function () {
            await Clerk.load();

            if (Clerk.user) {
                // Usu√°rio LOGADO
                document.getElementById('app-wrapper').style.display = 'block';
                
                // Monta o bot√£o do usu√°rio
                const userButtonDiv = document.getElementById('user-button');
                if (userButtonDiv) Clerk.mountUserButton(userButtonDiv);

                // Carrega o app
                renderPhase(0);
            } else {
                // Usu√°rio N√ÉO LOGADO
                Clerk.openSignIn({
                    afterSignInUrl: window.location.href,
                    appearance: { elements: { footer: "hidden" } }
                });
            }
        });

        // --- ESTADO GLOBAL DO APP ---
        let userState = JSON.parse(localStorage.getItem('jp_portal_state')) || {};
        let activePhase = 0;

        // --- RENDERIZA√á√ÉO ---
        function renderPhase(id) {
            activePhase = id;
            updateNav(id);
            const container = document.getElementById('app-content');
            const data = PORTAL_DATA[id];
            
            // Anima√ß√£o de entrada
            container.classList.remove('fade-in');
            void container.offsetWidth; 
            container.classList.add('fade-in');

            if (id === 0) {
                // TELA INICIAL
                let phasesHtml = data.phases_summary.map(p => `
                    <div onclick="renderPhase(${p.id})" class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm cursor-pointer hover:border-blue-300 hover:shadow-lg hover:-translate-y-1 transition-all flex items-center gap-4 mb-4 group active:scale-95">
                        <div class="w-12 h-12 rounded-2xl bg-blue-50 text-blue-600 flex items-center justify-center text-xl shadow-sm group-hover:scale-110 transition-transform">${p.icon}</div>
                        <div>
                            <h3 class="font-bold text-slate-800 text-lg">${p.title}</h3>
                            <p class="text-xs text-slate-500 font-medium">${p.sub}</p>
                        </div>
                        <i data-lucide="chevron-right" class="ml-auto text-blue-200 group-hover:text-blue-600"></i>
                    </div>
                `).join('');

                container.innerHTML = `
                    <div class="space-y-6">
                        <div id="motivation-card" class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-3xl p-6 text-white shadow-lg relative overflow-hidden">
                             <div class="flex items-center gap-2 mb-2 opacity-80"><i data-lucide="sparkles" class="w-4 h-4"></i><span class="text-[10px] font-black uppercase tracking-widest">Dose Di√°ria</span></div>
                             <p id="mot-text" class="text-sm font-medium mb-4 opacity-90">Precisa de um empurr√£ozinho hoje?</p>
                             <button onclick="getMotivation()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-xl text-xs font-bold flex items-center gap-2 transition-colors"><i data-lucide="rotate-ccw" class="w-3 h-3"></i> Receber Mensagem</button>
                        </div>

                        <div class="bg-white rounded-[2rem] p-8 shadow-xl border border-slate-100 relative overflow-hidden">
                            <h2 class="text-3xl font-black mb-4 leading-tight text-slate-800">${data.title}</h2>
                            <p class="text-slate-500 text-sm mb-6 font-medium">${data.intro}</p>
                            
                            <div class="mb-6 rounded-2xl overflow-hidden shadow-lg bg-black aspect-video relative">
                                ${getVideoHTML(data.videoSource)}
                            </div>

                            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                <p class="text-[10px] font-black uppercase text-blue-400 mb-1">Instru√ß√µes:</p>
                                <p class="text-xs text-blue-900 font-bold">${data.instructions}</p>
                            </div>
                        </div>

                        <div>${phasesHtml}</div>

                        <div class="mt-8 p-6 bg-slate-100 rounded-3xl border border-slate-200 text-center">
                            <h4 class="text-xs font-black text-slate-800 uppercase tracking-widest mb-2">${data.disclaimer.title}</h4>
                            <p class="text-[11px] text-slate-500 leading-relaxed mb-4 max-w-md mx-auto">${data.disclaimer.text}</p>
                            <div class="inline-flex items-center gap-2 px-4 py-2 bg-white rounded-full border border-slate-200 shadow-sm">
                                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                <p class="text-[10px] font-bold text-slate-700 uppercase">${data.disclaimer.crefito}</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // TELAS DE FASE
                let warningHtml = '';
                if(data.warning) {
                    if(data.warning.items) {
                        warningHtml = `<div class="mt-6 bg-red-50 border-l-4 border-red-400 rounded-r-2xl p-5 shadow-sm">
                            <div class="flex items-center gap-2 mb-3"><span class="text-xl">üö®</span><h4 class="text-xs font-black text-red-800 uppercase">${data.warning.title}</h4></div>
                            <p class="text-xs text-red-700 mb-4 opacity-80">${data.warning.intro}</p>
                            <div class="space-y-3">${data.warning.items.map(i => `<div class="bg-white/60 p-3 rounded-xl border border-red-100"><p class="text-xs font-bold text-red-900 mb-1">${i.label}</p><p class="text-[11px] text-red-700">${i.text}</p></div>`).join('')}</div>
                        </div>`;
                    } else {
                        let color = data.warning.type === 'stop' ? 'red' : 'amber';
                        warningHtml = `<div class="mt-4 p-4 bg-${color}-50 border-l-4 border-${color}-500 rounded-r-xl shadow-sm flex gap-3 items-center">
                            <div class="text-2xl">${data.warning.type === 'stop' ? '‚õî' : '‚ö†Ô∏è'}</div>
                            <div><p class="text-xs font-bold text-${color}-800 uppercase">${data.warning.title}</p><p class="text-xs text-${color}-700 mt-1">${data.warning.text}</p></div>
                        </div>`;
                    }
                }

                let exercisesHtml = data.sections.map((ex, idx) => {
                    let hasVideo = ex.videoSource && ex.videoSource !== "";
                    
                    return `
                    <div class="bg-white rounded-3xl overflow-hidden border border-slate-100 shadow-sm p-6 mb-4 hover:border-blue-200 transition-colors">
                        <div class="flex justify-between items-start mb-3 gap-4">
                            <div class="flex gap-3"><span class="text-slate-300 font-black text-sm">0${idx+1}</span><h4 class="font-black text-slate-800 text-sm italic">${ex.name}</h4></div>
                            <span class="text-[9px] font-black bg-slate-100 text-slate-600 px-2 py-1 rounded-lg uppercase whitespace-nowrap shrink-0">${ex.dosage}</span>
                        </div>
                        <p class="text-slate-500 text-xs leading-relaxed mb-4 pl-7 border-l-2 border-slate-100 whitespace-pre-line">${ex.desc}</p>
                        
                        ${ex.why ? `
                        <div class="ml-7 mb-4 p-3 bg-amber-50 rounded-xl border border-amber-100 flex gap-2">
                             <i data-lucide="lightbulb" class="w-4 h-4 text-amber-500 shrink-0 mt-0.5"></i>
                             <p class="text-[11px] text-amber-800 leading-tight"><strong>Para que serve:</strong> ${ex.why}</p>
                        </div>` : ''}

                        ${hasVideo ? `
                        <div id="vid-${idx}" class="hidden mb-4 bg-black rounded-xl overflow-hidden aspect-video">
                            ${getVideoHTML(ex.videoSource)}
                        </div>
                        <button onclick="toggleVideo('vid-${idx}')" class="w-full flex items-center justify-center gap-2 bg-slate-900 text-white py-3 rounded-xl text-[10px] font-black uppercase tracking-wider hover:bg-blue-600 transition-colors">
                            <i data-lucide="play" class="w-3 h-3"></i> Ver Execu√ß√£o
                        </button>
                        ` : ''}
                    </div>
                `}).join('');

                container.innerHTML = `
                    <div class="mb-8">
                        <span class="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[10px] font-bold uppercase mb-2 tracking-wider shadow-sm">${data.subtitle}</span>
                        <h2 class="text-3xl font-black text-slate-900 leading-tight mb-3">${data.title}</h2>
                        <p class="text-slate-600 text-sm leading-relaxed font-medium mb-6">${data.intro}</p>
                        
                        <div class="mb-6 rounded-2xl overflow-hidden shadow-lg bg-black aspect-video relative">
                            ${getVideoHTML(data.introVideoSource)}
                        </div>

                        ${data.regraOuro ? `<div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-r-xl shadow-sm"><p class="text-xs text-blue-900 font-bold">üíé ${data.regraOuro}</p></div>` : ''}
                        
                        ${warningHtml}
                    </div>

                    <div class="mb-10 bg-white rounded-3xl p-6 shadow-sm border border-slate-100">
                        <div class="flex items-center justify-between mb-4 pb-4 border-b border-slate-50">
                           <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Checklist da Fase</h3>
                           <span class="text-[10px] font-black text-blue-600 bg-blue-50 px-3 py-1 rounded-full" id="phase-counter">0/0</span>
                        </div>
                        <div class="space-y-3">${data.achievements.map((ach, idx) => {
                            let key = `f${id}_c${idx}`;
                            return `
                            <div onclick="toggleAch('${key}', ${id})" class="flex items-start gap-3 p-3 rounded-xl cursor-pointer hover:bg-slate-50 border-l-2 border-transparent hover:border-blue-500">
                                <div class="w-5 h-5 rounded border-2 flex items-center justify-center transition-all ${userState[key] ? 'bg-blue-600 border-blue-600' : 'border-slate-300'}">
                                    ${userState[key] ? '<i data-lucide="check" class="text-white w-3 h-3"></i>' : ''}
                                </div>
                                <label class="text-xs font-bold select-none ${userState[key] ? 'text-slate-400 line-through' : 'text-slate-700'}">${ach}</label>
                            </div>`
                        }).join('')}</div>
                    </div>

                    <div class="space-y-6">
                        <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-2 mb-4">Exerc√≠cios</h3>
                        ${exercisesHtml}
                    </div>
                `;
            }
            lucide.createIcons();
            updateProgress(); 
        }

        // --- FUN√á√ïES AUXILIARES ---
        function updateNav(id) {
            [0,1,2,3].forEach(i => {
                let btn = document.getElementById(`btn-${i}`);
                if(i === id) {
                    btn.className = "flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all bg-blue-600 text-white shadow-md scale-105";
                } else {
                    btn.className = "flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all text-slate-500 hover:bg-white/50";
                }
            });
        }

        function toggleAch(key, phaseId) {
            userState[key] = !userState[key];
            localStorage.setItem('jp_portal_state', JSON.stringify(userState));
            renderPhase(phaseId);
            checkCelebration(phaseId);
        }

        function checkCelebration(phaseId) {
            const achievements = PORTAL_DATA[phaseId].achievements;
            let allChecked = true;
            achievements.forEach((_, idx) => {
                if (!userState[`f${phaseId}_c${idx}`]) allChecked = false;
            });
            if (allChecked) {
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            }
        }

        function updateProgress() {
            let total = 0, done = 0;
            Object.keys(PORTAL_DATA).forEach(k => {
                if(k != 0 && PORTAL_DATA[k].achievements) {
                    PORTAL_DATA[k].achievements.forEach((_, i) => {
                        total++;
                        if(userState[`f${k}_c${i}`]) done++;
                    });
                }
            });
            
            let perc = total === 0 ? 0 : Math.round((done/total)*100);
            document.getElementById('global-progress-text').innerText = perc + "%";
            
            const circle = document.getElementById('progress-ring');
            const radius = circle.r.baseVal.value;
            const circumference = radius * 2 * Math.PI;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            const offset = circumference - (perc / 100) * circumference;
            circle.style.strokeDashoffset = offset;
        }

        function toggleVideo(id) {
            let el = document.getElementById(id);
            if(el) {
                el.classList.toggle('hidden');
                let video = el.querySelector('video');
                if(video && el.classList.contains('hidden')) video.pause();
            }
        }

        function getVideoHTML(source) {
            if(!source) return `<div class="w-full h-full flex flex-col items-center justify-center text-slate-500"><i data-lucide="video" class="w-8 h-8 mb-2 opacity-50"></i><span class="text-[10px] font-bold uppercase">Sem V√≠deo</span></div>`;
            return `<video src="${source}" controls playsinline class="w-full h-full object-cover"></video>`;
        }

        // --- SISTEMAS OFF-LINE (CHAT E MOTIVA√á√ÉO PR√â-PROGRAMADOS) ---
        
        // Banco de Frases Motivacionais
        const motivationQuotes = [
            "Cada passo conta. Hoje melhor que ontem! üí™",
            "A dor √© passageira, a gl√≥ria de voltar a andar √© eterna. üöÄ",
            "Respeite o processo. Seu corpo sabe o que faz. üå±",
            "Voc√™ √© mais forte do que essa les√£o. ü¶Å",
            "Paci√™ncia √© o m√∫sculo que voc√™ mais precisa treinar hoje. üßò‚Äç‚ôÇÔ∏è",
            "Foco no objetivo: voltar a fazer o que voc√™ ama! üéØ"
        ];

        function getMotivation() {
            let btn = document.querySelector('#motivation-card button');
            let txt = document.getElementById('mot-text');
            
            // Efeito visual de carregamento r√°pido
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-3 h-3"></i>`;
            
            setTimeout(() => {
                const randomMsg = motivationQuotes[Math.floor(Math.random() * motivationQuotes.length)];
                txt.innerText = randomMsg;
                txt.classList.add('font-bold', 'text-lg');
                btn.disabled = false;
                btn.innerHTML = `<i data-lucide="rotate-ccw" class="w-3 h-3"></i> Nova Mensagem`;
            }, 500);
        }

        // Banco de Respostas do Chatbot
        const botResponses = [
            { keywords: ["dor", "d√≥i", "doendo"], response: "Dor leve a moderada √© normal no in√≠cio. Se for uma dor aguda (pontada) ou n√£o passar com rem√©dio, pare o exerc√≠cio e fa√ßa gelo. Se persistir, avise seu m√©dico." },
            { keywords: ["incha√ßo", "inchado", "edema"], response: "Incha√ßo √© esperado nas primeiras semanas. Lembre-se do protocolo: Gelo (20min) + Perna elevada acima do cora√ß√£o + Mexer os dedos dos p√©s." },
            { keywords: ["gelo", "frio"], response: "O ideal √© fazer 20 minutos de gelo. Nunca coloque o gelo direto na pele (use um pano fino) e fa√ßa a cada 4 horas se estiver com dor/incha√ßo." },
            { keywords: ["muleta", "andar"], response: "S√≥ largue as muletas quando seu m√©dico liberar 'Carga Total'. Antes disso, respeite a fase de Carga Parcial para n√£o prejudicar a cicatriza√ß√£o." },
            { keywords: ["banho", "molhar"], response: "Proteja o curativo! A ferida cir√∫rgica n√£o deve ficar √∫mida. Use um saco pl√°stico bem vedado no banho at√© retirar os pontos." },
            { keywords: ["ola", "oi", "bom dia", "boa tarde"], response: "Ol√°! Como posso ajudar na sua recupera√ß√£o hoje?" }
        ];

        function toggleChat() {
            let modal = document.getElementById('chat-modal');
            let content = modal.querySelector('div');
            
            if(modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    content.classList.remove('translate-y-10', 'scale-95');
                }, 10);
            } else {
                modal.classList.add('opacity-0');
                content.classList.add('translate-y-10', 'scale-95');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function sendMessage(e) {
            e.preventDefault();
            let input = document.getElementById('chat-input');
            let text = input.value.toLowerCase().trim();
            if(!text) return;

            let chatBox = document.getElementById('chat-messages');
            chatBox.innerHTML += `<div class="flex justify-end"><div class="max-w-[85%] p-3 rounded-2xl text-xs leading-relaxed bg-blue-600 text-white rounded-br-none">${input.value}</div></div>`;
            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;

            // Simula "digitando..."
            let loadingId = 'load-' + Date.now();
            chatBox.innerHTML += `<div id="${loadingId}" class="flex justify-start"><div class="p-3"><i data-lucide="loader-2" class="animate-spin text-blue-500 w-4 h-4"></i></div></div>`;
            chatBox.scrollTop = chatBox.scrollHeight;

            setTimeout(() => {
                document.getElementById(loadingId).remove();
                
                // L√≥gica simples de resposta
                let reply = "Desculpe, ainda estou aprendendo. Para d√∫vidas m√©dicas espec√≠ficas, consulte o Dr. Jo√£o no WhatsApp.";
                
                // Procura palavra chave
                for (let item of botResponses) {
                    if (item.keywords.some(k => text.includes(k))) {
                        reply = item.response;
                        break;
                    }
                }

                chatBox.innerHTML += `<div class="flex justify-start"><div class="max-w-[85%] p-3 rounded-2xl text-xs leading-relaxed bg-white text-slate-700 shadow-sm border border-slate-200 rounded-bl-none">${reply}</div></div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 800); // Delay de 0.8s para parecer natural
        }
    </script>

    <script>
      // 1. Bloqueia o clique com o bot√£o direito (evita "Salvar como" ou "Inspecionar")
      document.addEventListener('contextmenu', event => event.preventDefault());

      // 2. Bloqueia atalhos de teclado comuns de clonagem/inspe√ß√£o
      document.onkeydown = function(e) {
        // Bloqueia F12, Ctrl+Shift+I, Ctrl+U (Ver c√≥digo fonte) e Ctrl+S
        if (e.keyCode == 123 || 
            (e.ctrlKey && e.shiftKey && e.keyCode == 73) || 
            (e.ctrlKey && e.keyCode == 85) || 
            (e.ctrlKey && e.keyCode == 83)) {
          return false;
        }
      };
    </script>
</body>
</html>
