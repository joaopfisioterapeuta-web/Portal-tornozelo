<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Reabilita√ß√£o Inteligente | Dr. Jo√£o Paulo Cardozo</title>
    <meta name="description" content="Portal oficial de recupera√ß√£o acelerada de tornozelo. Guia passo a passo.">
    
    <meta property="og:title" content="Portal do Paciente | Reabilita√ß√£o de Tornozelo">
    <meta property="og:description" content="Acesse seu protocolo de exerc√≠cios e orienta√ß√µes guiadas pelo Dr. Jo√£o Paulo.">
    <meta property="og:type" content="website">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%232563eb%22/><text x=%2250%%22 y=%2250%%22 text-anchor=%22middle%22 fill=%22white%22 font-family=%22sans-serif%22 font-weight=%22900%22 font-size=%2245%22 dy=%22.35em%22>JP</text></svg>">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .active-tab { background-color: #2563eb; color: white; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); transform: scale(1.02); }
        .achievement-card { transition: all 0.2s; border-left: 3px solid transparent; }
        .achievement-card:hover { border-left-color: #2563eb; background: #f1f5f9; }
        .achievement-card:active { transform: scale(0.98); }
        .custom-checkbox:checked + label { text-decoration: line-through; color: #94a3b8; }
        .animate-fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="antialiased min-h-screen pb-32">

    <header class="bg-white/90 backdrop-blur-xl border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-2xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="renderPhase(0)">
                <div class="w-10 h-10 rounded-xl bg-blue-600 flex items-center justify-center shadow-lg overflow-hidden relative border border-slate-100 group-hover:scale-105 transition-transform">
                    <img src="foto-jp.jpg" alt="JP" class="w-full h-full object-cover" onerror="this.style.display='none'; this.parentElement.innerHTML='<span class=\'text-white font-black italic\'>JP</span>';">
                </div>
                <div>
                    <span class="block text-[9px] font-black tracking-widest text-slate-400 uppercase">Fisioterapia</span>
                    <span class="block text-xs font-black tracking-tighter text-slate-800 leading-none group-hover:text-blue-600 transition-colors">REABILITA√á√ÉO INTELIGENTE</span>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <div class="text-right hidden sm:block">
                    <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Progresso</p>
                    <p id="header-perc" class="text-xs font-black text-blue-600">0%</p>
                </div>
                <div class="w-10 h-10 relative flex items-center justify-center">
                    <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                        <path class="text-slate-100" stroke-width="3" stroke="currentColor" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path id="progress-circle" class="text-blue-600 transition-all duration-1000" stroke-width="3" stroke-dasharray="0, 100" stroke-linecap="round" stroke="currentColor" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                    </svg>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-6 py-6">
        <nav class="flex gap-2 p-1 bg-slate-200 rounded-2xl mb-8 overflow-x-auto no-scrollbar shadow-inner sticky top-20 z-40">
            <button onclick="renderPhase(0)" id="tab-0" class="flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all whitespace-nowrap active-tab">IN√çCIO</button>
            <button onclick="renderPhase(1)" id="tab-1" class="flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all whitespace-nowrap text-slate-500 hover:bg-white/50">FASE 1</button>
            <button onclick="renderPhase(2)" id="tab-2" class="flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all whitespace-nowrap text-slate-500 hover:bg-white/50">FASE 2</button>
            <button onclick="renderPhase(3)" id="tab-3" class="flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all whitespace-nowrap text-slate-500 hover:bg-white/50">FASE 3</button>
        </nav>
        <div id="phase-content" class="animate-fade-in"></div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur border-t border-slate-200 p-4 z-50 safe-area-bottom shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
        <div class="max-w-2xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xl">üí¨</div>
                <div>
                    <p class="text-[10px] font-black text-slate-400 leading-none">D√öVIDAS?</p>
                    <p class="text-xs font-bold text-slate-700">Falar com Suporte</p>
                </div>
            </div>
            <a href="mailto:joaopfisioterapeuta@gmail.com" class="bg-slate-900 text-white px-6 py-3 rounded-xl text-[10px] font-black shadow-lg shadow-slate-200 active:scale-95 transition-transform">ENVIAR E-MAIL</a>
        </div>
    </nav>

    <script>
        const portalData = {
            0: {
                type: "intro",
                title: "üëã Bem-vindo √† sua Recupera√ß√£o",
                intro: "Voc√™ n√£o est√° sozinho. Este portal cont√©m o m√©todo exato para te levar da cirurgia at√© voltar a andar com seguran√ßa.",
                instructions: "Toque na fase correspondente abaixo para liberar seus exerc√≠cios di√°rios.",
                phases_summary: [
                    { id: 1, icon: "üõ°Ô∏è", title: "Fase 1: Prote√ß√£o", sub: "Semana 0-4 ‚Ä¢ Controle e Repouso" },
                    { id: 2, icon: "üë£", title: "Fase 2: Mobilidade", sub: "Liberado p√© no ch√£o (Carga Parcial)" },
                    { id: 3, icon: "üí™", title: "Fase 3: For√ßa Total", sub: "Liberado peso total (Largar Muletas)" }
                ],
                disclaimer: {
                    title: "Termos de Uso e Responsabilidade",
                    text: "Este aplicativo serve como guia de suporte e orienta√ß√£o domiciliar. Ele <strong>n√£o substitui</strong> o julgamento cl√≠nico do seu m√©dico ou fisioterapeuta presencial. Avance apenas se sentir seguran√ßa. Em caso de d√∫vidas ou dor persistente, suspenda os exerc√≠cios e procure ajuda profissional.",
                    crefito: "Respons√°vel T√©cnico: Dr. Jo√£o Paulo Cardozo (CREFITO 362213-F)"
                }
            },
            1: {
                title: "FASE 1: üõ°Ô∏è Prote√ß√£o",
                subtitle: "Semanas 0 a 4",
                intro: "Foco absoluto em desinchar e proteger a cirurgia. O objetivo √© manter o sangue circulando sem for√ßar o tornozelo.",
                warning: {
                    title: "üö® Sinais de Alerta (Triagem)",
                    intro: "O desconforto no local da cirurgia √© esperado. Por√©m, fique atento a estes sinais que N√ÉO s√£o normais:",
                    items: [
                        { label: "Risco de Trombose", text: "Dor aguda isolada na <b>panturrilha</b> (batata da perna), incha√ßo repentino e rigidez muscular." },
                        { label: "Sinais de Infec√ß√£o", text: "Ferida cir√∫rgica com secre√ß√£o (pus), vermelhid√£o que se espalha ou febre acima de 37.5¬∞C." },
                        { label: "Circula√ß√£o", text: "Dedos do p√© ficando muito p√°lidos (brancos) ou extremamente frios." }
                    ],
                    footer: "Se notar algum destes, procure seu m√©dico imediatamente."
                },
                regraOuro: "Regra de Ouro: O desconforto leve √© normal, mas 'pontadas' agudas na cirurgia n√£o. Respeite o limite da dor.",
                driveLink: "https://drive.google.com/file/d/1N7-q2EIOh5bYqCLatPmHZFw73GjCUK-E/view?usp=drivesdk",
                achievements: [
                    "Ferida operat√≥ria est√° seca e limpa",
                    "Consigo dormir sem dor intensa",
                    "Incha√ßo diminui pela manh√£",
                    "Consigo mover os dedos livremente"
                ],
                // EXERC√çCIOS CORRIGIDOS CONFORME O ARQUIVO .MD
                sections: [
                    { name: "Protocolo Di√°rio (Obrigat√≥rio)", desc: "üßä Gelo: 20min a cada 4h.\nü¶µ Eleva√ß√£o: Perna acima do cora√ß√£o 30min (3x/dia).\nü¶∂ Movimento: Mexer dedos sempre.", dosage: "Todo dia" },
                    { name: "1. Bombeamento Isom√©trico (A 'Bomba')", desc: "Fa√ßa for√ßa na batata da perna como se quisesse pisar no acelerador, mas SEM deixar o p√© mexer. Sinta o m√∫sculo endurecer, segure 3s e relaxe.", dosage: "3x 10 reps" },
                    { name: "2. O 'Pianista' (Mobilidade)", desc: "Com a perna esticada, tente abrir bem os dedos dos p√©s e depois fechar com for√ßa (como se fosse agarrar um objeto).", dosage: "3x 15 reps" },
                    { name: "3. Ativa√ß√£o de Gl√∫teo", desc: "Deitado, aperte uma n√°dega contra a outra com for√ßa. Segure 5s e relaxe. Ajuda na estabilidade do quadril.", dosage: "3x 15 reps" },
                    { name: "4. Eleva√ß√£o de Perna", desc: "Deitado, trave o joelho e levante a perna esticada. Fortalece coxa sem for√ßar o p√©.", dosage: "3x 10 reps" },
                    { name: "5. P√© no Ch√£o (Adapta√ß√£o)", desc: "Sentado, apoie o p√© no ch√£o sem peso. Se ficar vermelho/latejar √© normal (sangue descendo).", dosage: "2 min -> 15 min" }
                ]
            },
            2: {
                title: "FASE 2: üë£ Mobilidade",
                subtitle: "Carga Parcial Liberada",
                intro: "Vamos recuperar o movimento de 90¬∫ do tornozelo e ensinar seu p√© a receber peso novamente.",
                warning: { type: "info", title: "‚ö†Ô∏è Requisito de Seguran√ßa", text: "S√≥ realize o exerc√≠cio 'Balan√ßa' se o m√©dico j√° liberou colocar Carga Parcial (pisar com aux√≠lio)." },
                driveLink: "https://drive.google.com/file/d/1aECf1_hLa0Xfyr_RHAvSQXT_GInZ7TqL/view?usp=drivesdk",
                achievements: [
                    "P√© atinge 90 graus (√¢ngulo reto)",
                    "Piso com carga parcial sem dor aguda",
                    "Uso t√™nis confort√°vel",
                    "Iniciei o desmame das muletas"
                ],
                sections: [
                    { name: "1. Alongamento com Toalha", desc: "Puxe a ponta do p√© com uma toalha at√© sentir 'repuxar' a batata da perna.", dosage: "3x 30 seg" },
                    { name: "2. O Acelerador (Sem Carga)", desc: "Leve o p√© o m√°ximo para cima e para baixo. Tente ganhar 1mm a cada repeti√ß√£o.", dosage: "3x 15 reps" },
                    { name: "3. O Acelerador (Com El√°stico)", desc: "Empurre para baixo contra o el√°stico e segure a volta (n√£o deixe o el√°stico puxar de vez).", dosage: "3x 15 reps" },
                    { name: "4. A Balan√ßa (Descarga)", desc: "Em p√© com muletas, transfira levemente o peso para o p√© operado (pisando em ovos).", dosage: "3x 1 min" }
                ]
            },
            3: {
                title: "FASE 3: üí™ For√ßa Total",
                subtitle: "Retorno √† Vida Normal",
                intro: "Foco em fortalecer a panturrilha e treinar o equil√≠brio para evitar novas entorses. Prepara√ß√£o para alta.",
                warning: { type: "stop", title: "‚õî Requisito Obrigat√≥rio", text: "Esta fase exige libera√ß√£o m√©dica para CARGA TOTAL (pisar sem muletas)." },
                driveLink: "https://drive.google.com/file/d/1s96n1p49pQJZC0OXRtFfHr0oVYTG4op2/view?usp=drivesdk",
                achievements: [
                    "Subo/des√ßo degraus sem apoio",
                    "Fico na ponta dos p√©s (bipodal)",
                    "Equil√≠brio num p√© s√≥ (10s)",
                    "Caminho sem mancar"
                ],
                sections: [
                    { name: "1. Joelho na Parede", desc: "P√© a 10cm da parede, toque o joelho na parede sem tirar o calcanhar do ch√£o.", dosage: "3x 12 reps" },
                    { name: "2. Eleva√ß√£o de Calcanhar", desc: "Suba na ponta dos p√©s (Bipodal). Evolua para um p√© s√≥ (Unipodal) quando estiver forte.", dosage: "3x 15 reps" },
                    { name: "3. Mini-Agachamento", desc: "Apoie na cadeira e dobre levemente os joelhos. N√£o tire calcanhares do ch√£o.", dosage: "3x 10 reps" },
                    { name: "4. O Gar√ßa (Equil√≠brio)", desc: "Equilibre-se na perna operada. Tente soltar a m√£o da parede aos poucos.", dosage: "3x 30 seg" },
                    { name: "5. Passo sobre Obst√°culo", desc: "Passe a perna boa por cima de um objeto enquanto equilibra na operada.", dosage: "3x 10 voltas" }
                ]
            }
        };

        let userState = JSON.parse(localStorage.getItem('jp_portal_state')) || {};
        let activePhase = 0;

        function renderPhase(id) {
            activePhase = id;
            const container = document.getElementById('phase-content');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            if (id === 0) {
                const data = portalData[0];
                container.innerHTML = `
                    <div class="animate-fade-in space-y-6">
                        <div class="bg-gradient-to-br from-blue-600 to-blue-700 rounded-[2rem] p-8 text-white shadow-xl shadow-blue-200 relative overflow-hidden">
                            <div class="relative z-10">
                                <h2 class="text-3xl font-black mb-4 leading-tight tracking-tight">${data.title}</h2>
                                <p class="text-blue-100 text-sm leading-relaxed mb-6 font-medium">${data.intro}</p>
                                <div class="bg-blue-500/30 p-4 rounded-xl backdrop-blur-sm border border-blue-400/30">
                                    <p class="text-[10px] font-black uppercase tracking-widest text-blue-200 mb-1">Instru√ß√µes:</p>
                                    <p class="text-xs text-white">${data.instructions}</p>
                                </div>
                            </div>
                            <div class="absolute -bottom-10 -right-10 w-48 h-48 bg-blue-500 rounded-full opacity-30 blur-2xl"></div>
                        </div>

                        <div class="grid grid-cols-1 gap-4">
                            ${data.phases_summary.map(phase => `
                                <div onclick="renderPhase(${phase.id})" class="bg-white p-6 rounded-3xl border border-slate-100 shadow-[0_4px_20px_rgba(0,0,0,0.03)] cursor-pointer hover:border-blue-300 hover:shadow-lg hover:-translate-y-1 transition-all flex items-center gap-4 group active:scale-95">
                                    <div class="w-12 h-12 rounded-2xl bg-blue-50 text-blue-600 flex items-center justify-center text-xl group-hover:scale-110 transition-transform shadow-sm">${phase.icon}</div>
                                    <div>
                                        <h3 class="font-bold text-slate-800 text-lg">${phase.title}</h3>
                                        <p class="text-xs text-slate-500 font-medium">${phase.sub}</p>
                                    </div>
                                    <div class="ml-auto text-blue-200 group-hover:text-blue-600 transition-colors">‚ûú</div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="mt-8 p-6 bg-slate-100 rounded-3xl border border-slate-200 text-center">
                            <div class="w-10 h-10 bg-slate-200 rounded-full flex items-center justify-center text-lg mx-auto mb-3">‚öñÔ∏è</div>
                            <h4 class="text-xs font-black text-slate-800 uppercase tracking-widest mb-2">${data.disclaimer.title}</h4>
                            <p class="text-[11px] text-slate-500 leading-relaxed mb-4 max-w-md mx-auto">${data.disclaimer.text}</p>
                            <div class="inline-flex items-center gap-2 px-4 py-2 bg-white rounded-full border border-slate-200 shadow-sm">
                                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                <p class="text-[10px] font-bold text-slate-700 uppercase tracking-tight">${data.disclaimer.crefito}</p>
                            </div>
                        </div>
                    </div>
                `;
                updateNav(0);
                return;
            }

            const data = portalData[id];
            
            let warningHTML = '';
            if(data.warning) {
                if(data.warning.items && Array.isArray(data.warning.items) && typeof data.warning.items[0] === 'object') {
                    warningHTML = `
                        <div class="mt-6 bg-red-50 border-l-4 border-red-400 rounded-r-2xl p-5 shadow-sm">
                            <div class="flex items-center gap-2 mb-3">
                                <span class="text-xl">üö®</span>
                                <h4 class="text-xs font-black text-red-800 uppercase tracking-wider">${data.warning.title}</h4>
                            </div>
                            <p class="text-xs text-red-700 mb-4 opacity-80">${data.warning.intro}</p>
                            <div class="space-y-3">
                                ${data.warning.items.map(item => `
                                    <div class="bg-white/60 p-3 rounded-xl border border-red-100">
                                        <p class="text-xs font-bold text-red-900 mb-1">${item.label}</p>
                                        <p class="text-[11px] text-red-700 leading-tight">${item.text}</p>
                                    </div>
                                `).join('')}
                            </div>
                            <p class="text-[10px] text-red-600 mt-3 font-bold text-center border-t border-red-200 pt-2">${data.warning.footer}</p>
                        </div>
                    `;
                } else if (data.warning.type === 'stop') {
                     warningHTML = `<div class="mt-4 p-4 bg-red-50 border border-red-100 rounded-xl flex gap-3 items-center"><div class="text-2xl">‚õî</div><div><p class="text-xs font-bold text-red-800 uppercase tracking-wider">${data.warning.title}</p><p class="text-xs text-red-600 mt-1">${data.warning.text}</p></div></div>`;
                } else {
                    warningHTML = `<div class="mt-4 p-4 bg-amber-50 border border-amber-100 rounded-xl flex gap-3 items-center"><div class="text-2xl">‚ö†Ô∏è</div><div><p class="text-xs font-bold text-amber-800 uppercase tracking-wider">${data.warning.title}</p><p class="text-xs text-amber-700 mt-1">${data.warning.text}</p></div></div>`;
                }
            }

            container.innerHTML = `
                <div class="animate-fade-in">
                    <div class="mb-8">
                        <span class="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[10px] font-bold uppercase mb-2 tracking-wider shadow-sm">${data.subtitle}</span>
                        <h2 class="text-3xl font-black text-slate-900 leading-tight mb-3 tracking-tight">${data.title}</h2>
                        <p class="text-slate-600 text-sm leading-relaxed font-medium">${data.intro}</p>
                        
                        ${data.regraOuro ? `<div class="mt-4 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-r-xl shadow-sm"><p class="text-xs text-blue-900 font-bold leading-relaxed">üíé ${data.regraOuro}</p></div>` : ''}

                        ${warningHTML}

                        <a href="${data.driveLink}" target="_blank" class="mt-8 flex items-center justify-center gap-3 w-full bg-slate-900 text-white py-4 rounded-2xl shadow-xl shadow-slate-200 active:scale-95 transition-all group hover:bg-slate-800">
                            <span class="text-xl group-hover:scale-110 transition-transform">üé•</span>
                            <span class="font-black text-xs uppercase tracking-widest">Assistir Aula em V√≠deo</span>
                        </a>
                    </div>

                    <div class="mb-10 bg-white rounded-3xl p-6 shadow-[0_4px_20px_rgba(0,0,0,0.03)] border border-slate-100">
                        <div class="flex items-center justify-between mb-4 pb-4 border-b border-slate-50">
                            <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Checklist de Evolu√ß√£o</h3>
                            <span id="phase-counter" class="text-[10px] font-black text-blue-600 bg-blue-50 px-3 py-1 rounded-full">0/0</span>
                        </div>
                        <div class="space-y-3">
                            ${data.achievements.map((ach, idx) => {
                                const key = `f${id}_c${idx}`; 
                                return `<div onclick="toggleAch('${key}')" class="achievement-card flex items-start gap-3 p-3 rounded-xl cursor-pointer">
                                    <div class="relative pt-0.5">
                                        <input type="checkbox" ${userState[key] ? 'checked' : ''} class="custom-checkbox w-5 h-5 rounded border-2 border-slate-300 text-blue-600 appearance-none checked:bg-blue-600 checked:border-blue-600 transition-all">
                                        ${userState[key] ? '<svg class="w-3 h-3 text-white absolute top-1.5 left-1 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>' : ''}
                                    </div>
                                    <label class="text-xs font-bold text-slate-700 cursor-pointer select-none leading-relaxed ${userState[key] ? 'line-through text-slate-400' : ''}">${ach}</label>
                                </div>`;
                            }).join('')}
                        </div>
                    </div>

                    <div class="space-y-6">
                        <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-2 mb-4">Exerc√≠cios da Fase</h3>
                        ${data.sections.map((section, idx) => `
                            <div class="bg-white rounded-3xl overflow-hidden border border-slate-100 shadow-sm p-6 hover:border-blue-200 transition-colors">
                                <div class="flex justify-between items-start mb-3 gap-4">
                                    <div class="flex gap-3">
                                        <span class="text-slate-300 font-black text-sm">0${idx+1}</span>
                                        <h4 class="font-black text-slate-800 text-sm italic">${section.name}</h4>
                                    </div>
                                    <span class="text-[9px] font-black bg-slate-100 text-slate-600 px-2 py-1 rounded-lg uppercase whitespace-nowrap shrink-0">${section.dosage}</span>
                                </div>
                                <p class="text-slate-500 text-xs leading-relaxed mb-0 whitespace-pre-line pl-7 border-l-2 border-slate-100">${section.desc}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            updateNav(id);
            updateUI();
        }

        function updateNav(id) {
            for(let i=0; i<=3; i++) {
                const btn = document.getElementById('tab-'+i);
                if(btn) btn.className = i === id 
                    ? "flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all whitespace-nowrap active-tab scale-105 shadow-md" 
                    : "flex-1 py-3 px-4 rounded-xl text-[10px] font-black transition-all whitespace-nowrap text-slate-500 bg-slate-50 hover:bg-white hover:text-blue-600";
            }
        }

        function toggleAch(key) {
            userState[key] = !userState[key];
            localStorage.setItem('jp_portal_state', JSON.stringify(userState));
            renderPhase(activePhase);
        }

        function updateUI() {
            let total = 0, done = 0;
            Object.keys(portalData).forEach(pId => { if(pId !== "0") portalData[pId].achievements.forEach((_, idx) => { total++; if(userState[`f${pId}_c${idx}`]) done++; }); });
            const perc = Math.round((done/total)*100) || 0;
            document.getElementById('header-perc').innerText = perc + '%';
            document.getElementById('progress-circle').setAttribute('stroke-dasharray', `${perc}, 100`);
            if(activePhase !== 0) {
                const phaseTotal = portalData[activePhase].achievements.length;
                let phaseDone = 0;
                portalData[activePhase].achievements.forEach((_, idx) => { if(userState[`f${activePhase}_c${idx}`]) phaseDone++; });
                document.getElementById('phase-counter').innerText = `${phaseDone}/${phaseTotal}`;
                if(phaseDone === phaseTotal && phaseTotal > 0) confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: ['#2563eb', '#60a5fa', '#ffffff'] });
            }
        }
        window.onload = () => { renderPhase(0); };
    </script>
</body>
</html>
